<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ‘€ BigEyes</title>
  <style>
    :root { --bg:#0b1020; --card:#121833; --ink:#e8ecff; --muted:#9aa5d1; --accent:#7aa2ff; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, sans-serif; background:linear-gradient(180deg,#0b1020,#070b17); color:var(--ink); }
    header { padding:20px; border-bottom:1px solid #21306a; position:sticky; top:0; background:rgba(11,16,32,.6); backdrop-filter:blur(6px); text-align:center; }
    h1 { margin:0; font-size:24px; font-weight:800; display:flex; align-items:center; justify-content:center; gap:8px; }
    h1 .icon { font-size:26px; }
    main { max-width:900px; margin:0 auto; padding:20px; display:grid; gap:16px; }
    .card { background:var(--card); border:1px solid #223066; border-radius:16px; padding:16px; }
    .btn { display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:14px 18px; border-radius:14px; background:#1a2a6b; color:#fff; border:1px solid #3350aa; cursor:pointer; font-weight:700; font-size:18px; }
    .btn.secondary { background:#0e1430; border-color:#2a3a7a; color:#c9d3ff; font-weight:600; }
    .preview { width:100%; max-height:380px; object-fit:contain; border-radius:12px; border:1px solid #223066; }
    .grid { display:grid; gap:10px; grid-template-columns:repeat(2,1fr); }
    .list { display:grid; gap:10px; }
    .answer { white-space:pre-wrap; line-height:1.8; font-size:20px; }
    .row { display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:center; }
    select { padding:10px 12px; border-radius:10px; border:1px solid #3350aa; background:#0e1430; color:#e8ecff; }
    .muted { color: var(--muted); }
    .hidden { display:none; }
    .lead { font-size:15px; line-height:1.7; }
    .lead strong { color:#cfe0ff; }
  </style>
</head>
<body>
  <!-- í—¤ë”: íƒ€ì´í‹€ ê°€ìš´ë° + ì•„ì´ì½˜ -->
  <header>
    <h1><span class="icon">ğŸ‘€</span> BigEyes</h1>
  </header>

  <main>
    <!-- ì†Œê°œ ì„¹ì…˜ -->
    <section class="card" aria-label="intro">
      <h2 style="margin:0 0 8px 0;">BigEyes ì†Œê°œ</h2>
      <div class="lead">
        â€œì½ê¸° í˜ë“  ê¸€ì”¨, ëŒ€ì‹  ì •ë¦¬í•´ë“œë¦½ë‹ˆë‹¤â€
        <br/><br/>
        <strong>í•œëˆˆ ìš”ì•½ ì•± (for ë…¸ì•ˆÂ·ì§‘ì¤‘ í”¼ë¡œ)</strong><br/>
        â€œë§ì€ ì •ë³´, ë”± í•„ìš”í•œ ê²ƒë§Œ ê°„ë‹¨íˆâ€
        <br/><br/>
        <strong>GPT ìš”ì•½ ë„ìš°ë¯¸</strong><br/>
        â€œë‚´ ëˆˆê³¼ ë‡Œë¥¼ ëŒ€ì‹ í•˜ëŠ” ì‘ì€ ë¹„ì„œâ€
      </div>
    </section>

    <!-- STEP 0: ì–¸ì–´ -->
    <section class="card">
      <div class="row">
        <div>
          <strong id="langLabel">ì–¸ì–´</strong>
          <div style="height:6px"></div>
          <small id="langHelp" class="muted">ìš”ì•½ê³¼ ì¹´í…Œê³ ë¦¬ í‘œì‹œ ì–¸ì–´</small>
        </div>
        <select id="lang">
          <option value="ko" selected>í•œêµ­ì–´ (ko)</option>
          <option value="en">English (en)</option>
          <option value="ja">æ—¥æœ¬èª (ja)</option>
          <option value="zh">ä¸­æ–‡ (zh)</option>
        </select>
      </div>
    </section>

    <!-- STEP 1: ì—…ë¡œë“œ -->
    <section id="step-upload" class="card">
      <h2 id="step1">1) ì‚¬ì§„ ì„ íƒ</h2>
      <input id="file" type="file" accept="image/*" capture="environment" />
      <div style="height:10px"></div>
      <img id="img" class="preview hidden" alt="preview"/>
      <div style="height:10px"></div>
      <button id="btn-analyze" class="btn hidden">ğŸ” ì‘ì€ ê¸€ì”¨ ìš”ì•½</button>
    </section>

    <!-- STEP 2: ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
    <section id="step-categories" class="card hidden">
      <h2 id="step2">2) ì¹´í…Œê³ ë¦¬ ì„ íƒ</h2>
      <div id="cats" class="list"></div>
      <div style="height:10px"></div>
      <button id="btn-retry1" class="btn secondary">â†» ë‹¤ì‹œ ì°ê¸°</button>
    </section>

    <!-- STEP 3: ë‹µë³€ -->
    <section id="step-answer" class="card hidden">
      <h2 id="answer-title">3) ê²°ê³¼</h2>
      <div id="answer" class="answer"></div>
      <div style="height:10px"></div>
      <div class="grid">
        <button id="btn-back" class="btn secondary">â¬… ì¹´í…Œê³ ë¦¬ë¡œ ëŒì•„ê°€ê¸°</button>
        <button id="btn-retry2" class="btn secondary">â†» ë‹¤ì‹œ ì°ê¸°</button>
      </div>
    </section>
  </main>

  <script>
    // ===== i18n strings =====
    const I18N = {
      ko: { title:'ğŸ‘€ BigEyes', lang:'ì–¸ì–´', langHelp:'ìš”ì•½ê³¼ ì¹´í…Œê³ ë¦¬ í‘œì‹œ ì–¸ì–´', step1:'1) ì‚¬ì§„ ì„ íƒ', step2:'2) ì¹´í…Œê³ ë¦¬ ì„ íƒ', analyzeBtn:'ğŸ” ì‘ì€ ê¸€ì”¨ ìš”ì•½', retry:'â†» ë‹¤ì‹œ ì°ê¸°', back:'â¬… ì¹´í…Œê³ ë¦¬ë¡œ ëŒì•„ê°€ê¸°', core:'ğŸ§¾ í•µì‹¬ìš”ì•½' },
      en: { title:'ğŸ‘€ BigEyes', lang:'Language', langHelp:'Language for summaries & categories', step1:'1) Choose a photo', step2:'2) Choose a category', analyzeBtn:'ğŸ” Summarize tiny text', retry:'â†» Retake', back:'â¬… Back to categories', core:'ğŸ§¾ Core summary' },
      ja: { title:'ğŸ‘€ BigEyes', lang:'è¨€èª', langHelp:'è¦ç´„ã¨ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤ºè¨€èª', step1:'1) å†™çœŸã‚’é¸æŠ', step2:'2) ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ', analyzeBtn:'ğŸ” å°ã•ã„æ–‡å­—ã‚’è¦ç´„', retry:'â†» å–ã‚Šç›´ã™', back:'â¬… ã‚«ãƒ†ã‚´ãƒªã«æˆ»ã‚‹', core:'ğŸ§¾ è¦ç‚¹è¦ç´„' },
      zh: { title:'ğŸ‘€ BigEyes', lang:'è¯­è¨€', langHelp:'æ‘˜è¦ä¸ç±»åˆ«æ˜¾ç¤ºè¯­è¨€', step1:'1) é€‰æ‹©ç…§ç‰‡', step2:'2) é€‰æ‹©ç±»åˆ«', analyzeBtn:'ğŸ” æ‘˜è¦å°å­—', retry:'â†» é‡æ–°æ‹æ‘„', back:'â¬… è¿”å›ç±»åˆ«', core:'ğŸ§¾ æ ¸å¿ƒæ‘˜è¦' }
    };

    // ì„œë²„ë¦¬ìŠ¤ ê²½ë¡œ(ë™ì¼ ë„ë©”ì¸ ê¸°ì¤€)
    const API_BASE = '';
    const $ = (id) => document.getElementById(id);

    const elLangLabel = $('langLabel');
    const elLangHelp = $('langHelp');
    const elStep1 = $('step1');
    const elStep2 = $('step2');
    const elAnalyze = $('btn-analyze');
    const elRetry1 = $('btn-retry1');
    const elRetry2 = $('btn-retry2');
    const elBack = $('btn-back');

    const fileInput = $('file');
    const img = $('img');

    const stepUpload = $('step-upload');
    const stepCats = $('step-categories');
    const stepAnswer = $('step-answer');
    const catsWrap = $('cats');
    const answerBox = $('answer');
    const answerTitle = $('answer-title');

    const langSel = $('lang');

    let lastPayload = null; // { domain, categories, coreSummary }

    function applyI18n(){
      const L = I18N[langSel.value] || I18N.ko;
      document.title = L.title;
      elLangLabel.textContent = L.lang; elLangHelp.textContent = L.langHelp;
      elStep1.textContent = L.step1; elStep2.textContent = L.step2;
      elAnalyze.textContent = L.analyzeBtn; elRetry1.textContent = L.retry; elRetry2.textContent = L.retry; elBack.textContent = L.back;
    }
    langSel.addEventListener('change', applyI18n);
    applyI18n();

    // íŒŒì¼ ì„ íƒ â†’ ë¯¸ë¦¬ë³´ê¸°
    fileInput.addEventListener('change', async () => {
      const file = fileInput.files?.[0];
      if (!file) return;
      img.src = URL.createObjectURL(file);
      img.classList.remove('hidden');
      elAnalyze.classList.remove('hidden');
    });

    // Base64 ë³€í™˜
    const toBase64 = (file) => new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result.split(',')[1]);
      reader.readAsDataURL(file);
    });

    // ìš”ì•½ ìš”ì²­
    elAnalyze.addEventListener('click', async () => {
      const file = fileInput.files?.[0];
      if (!file) return alert('ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš” / Please choose an image');

      const busy = (langSel.value==='en' ? 'Recognizing...' :
                   (langSel.value==='ja'? 'èªè­˜ä¸­...' :
                   (langSel.value==='zh'?'è¯†åˆ«ä¸­...' : 'ì¸ì‹ ì¤‘...')));
      elAnalyze.textContent = busy;
      elAnalyze.disabled = true;

      const base64 = await toBase64(file);
      try {
        const r = await fetch(`${API_BASE}/api/summarize`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ imageBase64: base64, lang: langSel.value })
        });
        const data = await r.json();
        if (!data.success && !r.ok) throw new Error(data.message || 'ë¶„ì„ ì‹¤íŒ¨');

        lastPayload = data.payload || { categories:[], coreSummary:'' };
        stepUpload.classList.add('hidden');
        renderCategories();
        stepCats.classList.remove('hidden');
      } catch (e) {
        alert(e.message);
      } finally {
        elAnalyze.textContent = (I18N[langSel.value]||I18N.ko).analyzeBtn;
        elAnalyze.disabled = false;
      }
    });

    // ì¹´í…Œê³ ë¦¬ ë Œë”
    function renderCategories(){
      catsWrap.innerHTML = '';
      const list = lastPayload?.categories || [];
      list.forEach((c) => {
        const b = document.createElement('button');
        b.className = 'btn';
        b.textContent = c.title || '-';
        b.addEventListener('click', () => showAnswer(c.title, c.summary));
        catsWrap.appendChild(b);
      });
      // í•µì‹¬ìš”ì•½ ë²„íŠ¼
      const coreBtn = document.createElement('button');
      coreBtn.className = 'btn secondary';
      coreBtn.textContent = (I18N[langSel.value]||I18N.ko).core;
      coreBtn.addEventListener('click', () => showAnswer(coreBtn.textContent, lastPayload?.coreSummary || '-'));
      catsWrap.appendChild(coreBtn);
    }

    // ê²°ê³¼ ë³´ê¸°
    function showAnswer(title, text){
      answerTitle.textContent = title || 'ê²°ê³¼';
      answerBox.textContent = text || '-';
      stepCats.classList.add('hidden');
      stepAnswer.classList.remove('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ë¦¬ì…‹ & ë’¤ë¡œ
    function resetAll(){
      lastPayload = null; fileInput.value = ''; img.src = ''; img.classList.add('hidden');
      elAnalyze.classList.add('hidden');
      stepAnswer.classList.add('hidden');
      stepCats.classList.add('hidden');
      stepUpload.classList.remove('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    elRetry1.addEventListener('click', resetAll);
    elRetry2.addEventListener('click', resetAll);
    elBack.addEventListener('click', () => {
      stepAnswer.classList.add('hidden');
      stepCats.classList.remove('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>
</body>
</html>
