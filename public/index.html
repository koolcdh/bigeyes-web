<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BigEyes Â· ì‚¬ì§„ ìš”ì•½ + ì¿ íŒ¡ ìµœì €ê°€</title>
<meta name="theme-color" content="#0b1020"/>
<meta http-equiv="Permissions-Policy" content="camera=(self)" />
<style>
:root { --bg:#0b1020; --card:#121833; --ink:#e8ecff; --muted:#9aa5d1; --accent:#7aa2ff; --line:#223066; }
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink);
  font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
  background:#0b1020;
  padding-top:max(env(safe-area-inset-top,0px),20px);
}
header{
  position:sticky; top:0; padding:14px 16px;
  border-bottom:1px solid var(--line);
  background:#0b1020cc; backdrop-filter:blur(6px);
  text-align:center; z-index:5;
}
h1{margin:0;font-size:19px}
main{max-width:900px;margin:0 auto;padding:14px 16px 24px;display:grid;gap:14px}
.card{background:#121833e8;border:1px solid var(--line);border-radius:16px;padding:16px}
.lead{text-align:center;line-height:1.8}
.credit{font-weight:700;color:#b9c8ff}
.row{display:grid;gap:10px}
.grid2{display:grid;gap:10px;grid-template-columns:repeat(2,1fr)}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 16px;border-radius:14px;background:#1a2a6b;border:1px solid #3350aa;color:#fff;font-weight:700;cursor:pointer}
.btn.secondary{background:#0e1430;border-color:#2a3a7a;color:#c9d3ff}
.btn[disabled]{opacity:.5;cursor:not-allowed}
input[type="file"]{display:none}
input[type="text"]{
  width:100%;padding:12px 14px;border-radius:12px;border:1px solid #2a3a7a;background:#0e1430;color:#e8ecff
}
/* âœ¨ ê²°ê³¼ ë°•ìŠ¤ ë‚´ë¶€ ìŠ¤í¬ë¡¤ (ìˆ˜ì •ì‚¬í•­ 3) */
textarea.summary-box{
  width:100%; min-height:220px; max-height:300px;  /* ê³ ì • ìƒí•œ */
  padding:12px 14px; border-radius:12px; border:1px solid #2a3a7a;
  background:#0e1430; color:#e8ecff; line-height:1.7; font-size:15px;
  white-space:pre-wrap; resize:vertical; overflow-y:auto;
}
.preview{width:100%;max-height:380px;object-fit:contain;border-radius:12px;border:1px solid var(--line)}
.hidden{display:none}
.small{font-size:13px;color:#9aa5d1}
.section-title{margin:0 0 6px}

/* ë¡œë”© ì˜¤ë²„ë ˆì´ */
#loadingOverlay{position:fixed; inset:0; display:none; place-items:center; background:rgba(6,10,25,.58); backdrop-filter: blur(6px); z-index:9999;}
#loadingOverlay.show{display:grid}
.loader{display:inline-flex; align-items:center; gap:10px; background:#121833; border:1px solid #223066; color:#e8ecff; padding:12px 18px; border-radius:12px; font-weight:700;}
.loader-dot{width:8px;height:8px;border-radius:50%;background:#7aa2ff;animation:bounce .9s infinite ease-in-out}
.loader-dot:nth-child(2){animation-delay:.15s}
.loader-dot:nth-child(3){animation-delay:.3s}
@keyframes bounce{0%,80%,100%{transform:scale(0.8);opacity:.6}40%{transform:scale(1);opacity:1}}

.brand-line{
  font-size:22px; font-weight:800; letter-spacing:-0.2px; margin-bottom:6px;
  background:linear-gradient(90deg,#c2d0ff,#7aa2ff,#c2d0ff);
  -webkit-background-clip:text; background-clip:text; color:transparent;
}
@media (min-width:680px){ .brand-line{ font-size:24px; } }

/* ì¶”ì • ì„¹ì…˜ ë°•ìŠ¤ */
.box {
  border:1px solid #2a3a7a; background:#0e1430; border-radius:12px; padding:12px;
}
.box pre{margin:0; white-space:pre-wrap; line-height:1.7; font-size:15px; color:#e8ecff}
.field-hint{margin-top:6px; font-size:13px; opacity:.7;}
</style>
</head>
<body>
<header><h1>ğŸ‘€ BigEyes Â· ì‚¬ì§„ ìš”ì•½ + ì¿ íŒ¡ ìµœì €ê°€</h1></header>

<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div id="loadingOverlay" aria-live="polite" aria-busy="true">
  <div class="loader">
    <span class="loader-dot"></span><span class="loader-dot"></span><span class="loader-dot"></span>
    <span>ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œìš”</span>
  </div>
</div>

<main>
  <!-- ì¸íŠ¸ë¡œ -->
  <section class="card">
    <div class="lead">
      <div class="brand-line">ë„ˆë¥¼ ìœ„í•´ GPTê°€ ì¤€ë¹„í–ˆì–´</div>
      <strong>ì‚¬ì§„ ì† ì‘ì€ ê¸€ì”¨, í•œëˆˆì— ìš”ì•½</strong> + <strong>ì¿ íŒ¡ ìµœì €ê°€ ì°¾ê¸°</strong><br/>
      ê°€ì… X Â· ì €ì¥ X Â· ë°”ë¡œ ì‚¬ìš©
    </div>
    <p style="text-align:center;margin:8px 0 0">
      <span id="creditTop" class="credit">(ì´ìš© ê°€ëŠ¥ ê±´ìˆ˜ : 0000ê±´)</span>
    </p>
    <p class="small" style="text-align:center;margin:2px 0 0">
      <a href="/privacy.html">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a> Â· <a href="/terms.html">ì´ìš©ì•½ê´€</a>
    </p>
  </section>

  <!-- STEP 1: ì—…ë¡œë“œ -->
  <section id="stepUpload" class="card">
    <div class="row" style="grid-template-columns:1fr auto;align-items:center">
      <h2 class="section-title">1) ì‚¬ì§„ ì„ íƒ</h2>
      <div id="creditTop2" class="credit"></div>
    </div>

    <div class="row">
      <label class="btn">
        ğŸ“· ì¹´ë©”ë¼ë¡œ ì°ê¸°
        <input id="fileCam" type="file" accept="image/*;capture=camera" capture="environment">
      </label>
      <label class="btn">
        ğŸ“ íŒŒì¼ì—ì„œ ì„ íƒ
        <input id="filePick" type="file" accept="image/*">
      </label>
    </div>

    <img id="imgPrev" class="preview hidden" alt="preview"/>

    <div class="grid2" style="margin-top:8px">
      <button id="btnAnalyze" class="btn hidden">ğŸ” ì‘ì€ ê¸€ì”¨ ìš”ì•½</button>
      <button id="btnCoupangFlow" class="btn secondary hidden">ğŸ›’ ì¿ íŒ¡ ìµœì €ê°€ ê°€ê¸°</button>
    </div>
    <p class="small">â€» ë³¸ ë§í¬ëŠ” ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ìœ¼ë¡œ ì¼ì • ìˆ˜ìˆ˜ë£Œë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
  </section>

  <!-- STEP 2-A: ë³´ê³ ì„œ -->
  <section id="stepSummary" class="card hidden">
    <h2 class="section-title">2) ìš”ì•½ ê²°ê³¼(ë³´ê³ ì„œ)</h2>

    <!-- OCR ê²°ê³¼: textarea ë‚´ë¶€ ìŠ¤í¬ë¡¤ (ìˆ˜ì •3) -->
    <textarea id="sumReadOnly" class="summary-box" readonly></textarea>

    <!-- ì¶”ì • ì„¹ì…˜(ìˆ˜ì •2) -->
    <div class="box" style="margin-top:12px;">
      <div class="small" style="opacity:.8;margin-bottom:6px;">â–  ì¶”ì • ë¶„ì„ (ì°¸ê³ ìš©)</div>
      <pre id="guessBox">â€» ì‹œê°ì  íŠ¹ì§• ê¸°ë°˜ ì¶”ì • ê²°ê³¼ì´ë©° ì‹¤ì œì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</pre>
    </div>

    <div class="row" style="grid-template-columns:1fr auto;align-items:center">
      <button id="btnBackSum" class="btn secondary">â¬… ì´ì „ í™”ë©´ìœ¼ë¡œ</button>
      <button id="btnGoCoupangDirect" class="btn">ğŸ›’ ì¿ íŒ¡ìµœì €ê°€ ê°€ê¸°</button>
    </div>
    <p class="small">â€» ìš”ì•½ì„ ë°”íƒ•ìœ¼ë¡œ ê²€ìƒ‰ì–´ë¥¼ ë§Œë“¤ê³ , ë‹¤ìŒ í™”ë©´ì—ì„œ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ìš”.</p>
  </section>

  <!-- STEP 2-B: ì¿ íŒ¡ í‚¤ì›Œë“œ í™•ì¸ -->
  <section id="stepCoupang" class="card hidden">
    <h2 class="section-title">2) ì¿ íŒ¡ ê²€ìƒ‰ ì „ í™•ì¸</h2>

    <label><strong>ìš”ì•½ ë‚´ìš©</strong></label>
    <textarea id="sumBox" class="summary-box" readonly></textarea>

    <label style="margin-top:8px;"><strong>ê²€ìƒ‰ì–´</strong></label>
    <input id="kwFinal" type="text" placeholder="ì¿ íŒ¡ ê²€ìƒ‰ì–´" />
    <!-- ìˆ˜ì •4: ìˆ˜ì • ë²„íŠ¼ ì œê±° + ì•ˆë‚´ ë¬¸êµ¬ -->
    <div class="field-hint">â€» ë³€ê²½ í•„ìš”ì‹œ ì§ì ‘ ë³€ê²½í•˜ì„¸ìš”.</div>

    <div class="grid2" style="margin-top:8px">
      <button id="btnBack2" class="btn secondary">â¬… ì´ì „ í™”ë©´ìœ¼ë¡œ</button>
      <button id="btnGoCoupang" class="btn">ğŸ›’ ìµœì €ê°€ ë³´ëŸ¬ê°€ê¸°</button>
    </div>
  </section>

  <!-- ë³´ìƒí˜• ê´‘ê³  -->
  <section class="card">
    <h3 class="section-title">ğŸ ë³´ìƒí˜• ê´‘ê³ </h3>
    <p class="small">ê´‘ê³ ë¥¼ ì‹œì²­í•˜ë©´ ì´ìš© ê°€ëŠ¥ ê±´ìˆ˜ê°€ <strong>1íšŒ</strong> ì¶©ì „ë©ë‹ˆë‹¤.</p>
    <button id="btnReward" class="btn">ê´‘ê³  ë³´ê³  1íšŒ ì¶©ì „</button>
  </section>
</main>

<script>
/* ===== ì„¤ì • ===== */
const PARTNER_ID = 'AF2974050';
const SUB_ID     = 'bigeyes';
const LS_KEY = 'be_credits_v08';
const DEFAULT_CREDITS = 3;
const MAX_CREDITS = 9999;

/* ===== ìƒíƒœ/ìš”ì†Œ ===== */
let lastImageBlob = null;
let lastOCR = null;           // ì„œë²„ì—ì„œ ë°›ì€ payload(=ìš”ì•½ + ì¶”ì²œê²€ìƒ‰ì–´ + ì¶”ì •)
let ocrDoneForThisImage = false;

const $ = id => document.getElementById(id);
const creditTop=$('creditTop'), creditTop2=$('creditTop2');
const stepUpload=$('stepUpload'), stepSummary=$('stepSummary'), stepCoupang=$('stepCoupang');
const fileCam=$('fileCam'), filePick=$('filePick'), imgPrev=$('imgPrev');
const btnAnalyze=$('btnAnalyze'), btnCoupangFlow=$('btnCoupangFlow');
const sumReadOnly=$('sumReadOnly'), btnBackSum=$('btnBackSum');
const sumBox=$('sumBox'), kwFinal=$('kwFinal');
const btnBack2=$('btnBack2'), btnGoCoupang=$('btnGoCoupang');
const btnReward=$('btnReward');
const loadingOverlay=$('loadingOverlay');
const guessBox=$('guessBox');

/* ===== ê³µí†µ ===== */
async function showLoading(on=true){
  if(on){ loadingOverlay.classList.add('show'); await new Promise(requestAnimationFrame); }
  else  { loadingOverlay.classList.remove('show'); }
}
function clamp(n,lo,hi){return Math.max(lo,Math.min(hi,n))}
function pad4(n){return String(n).padStart(4,'0')}
function loadCredits(){const n=parseInt(localStorage.getItem(LS_KEY)||`${DEFAULT_CREDITS}`,10);return clamp(Number.isFinite(n)?n:DEFAULT_CREDITS,0,MAX_CREDITS)}
function saveCredits(n){const v=clamp(n,0,MAX_CREDITS);localStorage.setItem(LS_KEY,String(v));renderCredits(v)}
function renderCredits(v=loadCredits()){
  const txt=`(ì´ìš© ê°€ëŠ¥ ê±´ìˆ˜ : ${pad4(v)}ê±´)`;
  creditTop.textContent=txt; creditTop2.textContent=txt;
}
(function initCredits(){const p=new URLSearchParams(location.search); if(p.has('reset')) localStorage.removeItem(LS_KEY); renderCredits();})();

/* ===== ìœ í‹¸ ===== */
/* (ìˆ˜ì •1) ì—…ë¡œë“œ ì „ ë¦¬ì‚¬ì´ì¦ˆ ê°•ë„â†‘ : maxSide=1200 */
async function toBase64(file, maxSide=1200, quality=0.8){
  const img = await new Promise(res=>{ const i=new Image(); i.onload=()=>res(i); i.onerror=()=>res(null); i.src=URL.createObjectURL(file); });
  if(!img) throw new Error('ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
  const {width, height} = img;
  const scale = Math.min(1, maxSide / Math.max(width, height));
  const w = Math.round(width * scale), h = Math.round(height * scale);
  const canvas = document.createElement('canvas'); canvas.width=w; canvas.height=h;
  const ctx = canvas.getContext('2d'); ctx.drawImage(img,0,0,w,h);
  return canvas.toDataURL('image/jpeg',quality).split(',')[1];
}
function coupangAppUrl(q){return 'coupang://search?q='+encodeURIComponent(q)}
function coupangWebUrl(q){const base='https://www.coupang.com/np/search';const params=new URLSearchParams({q,channel:'user',lptag:PARTNER_ID,subId:SUB_ID});return `${base}?${params.toString()}`}

/* ===== ë³´ê³ ì„œ ë¹Œë“œ (OCR í…ìŠ¤íŠ¸ë¥¼ ë³´ê¸° ì¢‹ê²Œ) ===== */
function buildReport(payload){
  const lines=[];
  const core = String(payload.coreSummary||'').trim();
  if(core){
    lines.push('â–  í•µì‹¬ ìš”ì•½');
    for(const l of core.split('\n').filter(Boolean)){ lines.push(' - ' + l.replace(/^\s*-\s*/,'').trim()); }
    lines.push('');
  }
  const cats = Array.isArray(payload.categories)? payload.categories : [];
  for(const c of cats){
    const title = c.title || c.key || 'ì„¸ë¶€ì •ë³´';
    const sum = String(c.summary||'').trim();
    if(!sum) continue;
    lines.push(`â–  ${title}`);
    for(const l of sum.split('\n').filter(Boolean)){ lines.push(' - ' + l.replace(/^\s*-\s*/,'').trim()); }
    lines.push('');
  }
  const rq = String(payload.coupangQuery||'').trim();
  if (rq){ lines.push('â–  ì¿ íŒ¡ ì¶”ì²œ ê²€ìƒ‰ì–´'); lines.push(' - ' + rq, ''); }
  return lines.join('\n');
}

/* ===== íŒŒì¼ ì„ íƒ ì²˜ë¦¬ ===== */
let _pickBusy=false, _lastPickKey='';
async function onPick(file, from){
  try{
    if(!file) return;
    const key = `${file.name}|${file.size}|${file.lastModified||Date.now()}`;
    if(_pickBusy || key===_lastPickKey) return;
    _pickBusy=true; _lastPickKey=key;

    lastImageBlob = file;

    const dataUrl = await new Promise((resolve, reject)=>{
      const fr = new FileReader(); fr.onload=()=>resolve(fr.result); fr.onerror=()=>reject(new Error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨')); fr.readAsDataURL(file);
    });
    imgPrev.src = dataUrl; imgPrev.classList.remove('hidden');
    btnAnalyze.classList.remove('hidden'); btnCoupangFlow.classList.remove('hidden');

    if(from==='cam') fileCam.value=''; if(from==='pick') filePick.value='';
    ocrDoneForThisImage=false; lastOCR=null;
  }catch(err){ alert((err && err.message) || 'ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'); }
  finally{ setTimeout(()=>{ _pickBusy=false; }, 250); }
}
fileCam.addEventListener('change', e=>{ onPick(e.target.files?.[0], 'cam'); });
filePick.addEventListener('change', e=>{ onPick(e.target.files?.[0], 'pick'); });

/* ===== OCR(í•œ ë²ˆë§Œ ì°¨ê°) ===== */
let _ocrPromise=null;
async function ensureOCR(){
  if(!lastImageBlob) throw new Error('ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
  if(lastOCR) return lastOCR;
  if(_ocrPromise) return _ocrPromise;

  _ocrPromise = (async ()=>{
    if(!ocrDoneForThisImage){
      const cur=loadCredits(); if(cur<=0) throw new Error('ì”ì—¬ ê±´ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.\n\ní•˜ë‹¨ì˜ [ê´‘ê³  ë³´ê³  1íšŒ ì¶©ì „]ì„ ëˆ„ë¥´ë©´ 1íšŒ ë¬´ë£Œ ì¶©ì „ë¼ìš”!');
      saveCredits(cur-1); ocrDoneForThisImage=true;
    }
    const base64=await toBase64(lastImageBlob).catch(()=>null);
    if(!base64){ throw new Error('ì‚¬ì§„ ìš©ëŸ‰ì´ ì»¤ì„œ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); }

    const r=await fetch(`/api/summarize`,{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({imageBase64:base64,lang:'ko'})
    });
    let data; try{ data=await r.json(); }
    catch{
      const text=await r.text().catch(()=> '');
      if(r.status===413 || /Entity Too Large/i.test(text)) throw new Error('ì´ë¯¸ì§€ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. í•´ìƒë„ë¥¼ ë‚®ì¶”ê±°ë‚˜ ì••ì¶• í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
      throw new Error(text?.slice(0,120) || 'ì„œë²„ ì‘ë‹µì„ ì½ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
    }
    if(!r.ok || !data?.success) throw new Error(data?.message||'ìš”ì•½ ì‹¤íŒ¨');
    lastOCR=data.payload; return lastOCR;
  })().finally(()=>{ _ocrPromise=null; });
  return _ocrPromise;
}

/* ===== ì¿ íŒ¡ ë§í¬ ===== */
function keywordFromSummary(t=''){
  const raw=String(t||'').split('\n').map(s=>s.trim()).filter(Boolean);
  const skip=/(â– |ê°€ê²©|ì›|í• ì¸|í–‰ì‚¬|ì¿ í°|ê¸°ê°„|ì£¼ì˜|ê²½ê³ |ë³´ê´€|ì‚¬ìš©ë²•|ì°¸ì¡°)/;
  const lines=raw.filter(s=>!/^â– /.test(s)).filter(s=>!skip.test(s));
  const bullets=lines.filter(s=>/^[-â€¢]/.test(s)).map(s=>s.replace(/^[-â€¢]\s*/,'').trim());
  const token=/([A-Z]{2,}\d{1,}|\d{3,}[A-Z]{1,}|[A-Za-z]{3,}\d{1,}|\b[ê°€-í£A-Za-z]{2,}\b)/g;
  const cands=(bullets.length?bullets:lines).map(s=>(s.match(token)||[]).join(' ').trim()).filter(s=>s&&s.length>=2);
  let out=(cands[0]||(bullets[0]||lines[0]||'')).replace(/[()ï¼»\]ã€ã€‘{}<>:;'"â€œâ€â€˜â€™]/g,' ').replace(/\s{2,}/g,' ').trim();
  if(out.length>80) out=out.slice(0,80);
  return out;
}
function coupangAppUrl2(q){return 'coupang://search?q='+encodeURIComponent(q)}
function coupangWebUrl2(q){const base='https://www.coupang.com/np/search';const params=new URLSearchParams({q,channel:'user',lptag:PARTNER_ID,subId:SUB_ID});return `${base}?${params.toString()}`} // keep both helpers if needed

/* ===== í”Œë¡œìš° ===== */
$('btnAnalyze').addEventListener('click', async ()=>{
  await showLoading(true);
  try{
    const payload=await ensureOCR();
    const report=buildReport(payload);
    sumReadOnly.value=report;

    // ì¶”ì • ì„¹ì…˜ ì±„ìš°ê¸° (ìˆ˜ì •2)
    guessBox.textContent = (payload.guessSummary && String(payload.guessSummary).trim()) || 'ì¶”ì • ê²°ê³¼ ì—†ìŒ';

    const btnGo=$('btnGoCoupangDirect');
    btnGo.onclick=()=>{
      sumBox.value=report;
      sumBox.readOnly=true;
      kwFinal.value=(payload.coupangQuery && payload.coupangQuery.trim()) || keywordFromSummary(report);
      stepSummary.classList.add('hidden');
      stepCoupang.classList.remove('hidden');
      window.scrollTo({top:0,behavior:'smooth'});
    };

    stepUpload.classList.add('hidden');
    stepSummary.classList.remove('hidden');
    window.scrollTo({top:0,behavior:'smooth'});
  }catch(e){ alert(e.message||'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); }
  finally{ await showLoading(false); }
});

$('btnBackSum').addEventListener('click', ()=>{
  stepSummary.classList.add('hidden'); stepUpload.classList.remove('hidden');
});

$('btnCoupangFlow').addEventListener('click', async ()=>{
  await showLoading(true);
  try{
    const payload=await ensureOCR();
    const report=buildReport(payload);
    sumBox.value=report;
    sumBox.readOnly=true;
    kwFinal.value=(payload.coupangQuery && payload.coupangQuery.trim()) || keywordFromSummary(report);
    stepUpload.classList.add('hidden');
    stepCoupang.classList.remove('hidden');
    window.scrollTo({top:0,behavior:'smooth'});
  }catch(e){ alert(e.message||'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); }
  finally{ await showLoading(false); }
});

$('btnGoCoupang').addEventListener('click', ()=>{
  const keyword=(kwFinal.value||'').trim();
  if(!keyword) return alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
  const appU=coupangAppUrl(keyword), webU=coupangWebUrl(keyword);
  location.href=appU; setTimeout(()=>window.open(webU,'_blank','noopener,noreferrer'),400);
});
$('btnBack2').addEventListener('click', ()=>{
  stepCoupang.classList.add('hidden'); stepUpload.classList.remove('hidden');
});

/* ===== ë³´ìƒí˜• ê´‘ê³ (ë¡œì»¬ í¬ë ˆë”§) ===== */
$('btnReward').addEventListener('click', ()=>{
  saveCredits(loadCredits()+1);
  alert('ê´‘ê³  ì‹œì²­ ì™„ë£Œ! 1íšŒ ì¶©ì „ë˜ì—ˆìŠµë‹ˆë‹¤.');
});

/* ===== íŒŒì¼ input ë°”ì¸ë”© ===== */
fileCam.addEventListener('change', e=>{ onPick(e.target.files?.[0], 'cam'); });
filePick.addEventListener('change', e=>{ onPick(e.target.files?.[0], 'pick'); });
</script>
</body>
</html>
